{% extends 'base.html' %}
{% load static %}
{% block head %}
{% block title %}<title>{{my_post}}</title>{% endblock title %}
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="{% static 'css/index.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/detail.css' %}">
{% endblock head %}



{% block content %}
<div class="back"><a href="{{ request.META.HTTP_REFERER }}">뒤로가기</a></div>
<div class="category">{{my_post.category}}</div>

<div class="detail-wrapper">
    <div class="content-wrapper">
        <div class="user">{{my_post.writer}}</div>
        <div class="title">제목: {{my_post.title}}</div>
        <div class="content"> {{my_post.content|safe}}</div>
        {% if my_post.myimage %}
            <div class="image">
                <img src="{{my_post.myimage.url}}" title="첨부 이미지" alt="게시판 글 이미지">
            </div>
            {% endif %}
    </div>
    <div class="sub-wrapper">
        <div class="count-wrapper">
        <!-- 조회수 -->
            {% if my_post.writer == user.nickname %}
                <div class="delete-post"><a href="{% url 'delete_post' pk=my_post.id  %}">글 삭제</a></div>
            {% endif %}
            <div class="hit-count">조회수 : {{my_post.current_hit_count }} </div> 
            <div class="like">
                
                <a href="{% url 'like_toggle' my_post.id  %}">
                {% if my_post in user.like_post.all %}
                취소
                {% else %}
                좋아요
                {% endif %}
                </a> 
                {{my_post.like_count}} 
            </div> 
        </div> 
        <div class="time">{{my_post.updated_at}}</div>
         <!-- 해당 포스트 작성유저가 현재 요청된 유저의 닉네임과 같을때 -->
         
    </div>
  
        
        
       
    

    
</div>

<form method="POST" action="{% url 'create_comment' my_post.id %}" class="comment-form">
    {% csrf_token %}
    {{comment_form}}
    <input type="submit">
</form>

<div class="comment-wrapper">
    {% for comment in my_post.comment_set.all %}
    <div class="comment">{{comment.body}}</div>
    <div class="comment-time">{{comment.created_at}}</div>
    <div class="writer">{{comment.writer}}</div>
    {%if user.nickname == comment.writer %}
    <div class="delete-comment">
        <a href="{% url 'delete_comment' comment.id %}">삭제</a>
    </div>
    {% endif %}
    <!-- 나중에 클릭하면 대댓글 폼 나타나게 구현하기 -->
    <div class="recomment-btn">대댓글</div>
        <form method="POST" action="{% url 'create_recomment' my_post.id comment.id %}" class="recomment-form">
            {% csrf_token %}
            {{recomment_form}}
            <input type="submit">
        </form>
        {% for recomment in comment.recomment.all %}
            <div class="recomment">대댓글:{{recomment.body}}</div>
            <div class="recomment-time">{{recomment.created_at}}</div>
            <div class="writer">{{recomment.writer}}</div>
            <!-- 요청된 유저가 해당 글쓴이와 같으면 -->
            {%if user.nickname == recomment.writer %}
            <div class="delete-recomment">
                <a href="{% url 'delete_recomment' recomment.id %}">삭제</a>
            </div>

            {% endif %}
        {% endfor %}
    {% endfor %}
</div>




<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous">
</script>
<script>
    $('.delete-comment').click(function(){
        
        alert('댓글을 정말 삭제하시겠습니까?');
    });

    // $('.delete-post').click(function(){
        
    //     alert('게시물을 삭제하시겠습니까?');
    // });
</script>




{% endblock content %}
